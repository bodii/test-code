<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>生态圈对象</title>
</head>
<body>
	<script type="text/javascript">
		'use strict'

		// wall 变量拥有一个用于标记网格上墙的位置的对象
		var wall = {};

		// elementFromCharacter函数将在plan里读取的一个字符转换为存储于网格中的实际值 
		function elementFromCharacter (character) {
			if (character == ' ')
				return undefined;
			else if (character == '#')
				retur wall;
			else if (character == 'o')
				return new StupidBug();
		}

		function Terrarium (plan) {
			var grid = new Grid(plan[0].length, plan.length);
			for (let y = 0; y < plan.length; y++) {
				var line = plan[y];
				for (let x = 0; x < line.length; x++) {
					grid.setValueAt(new Point(x, y), elementFromCharacter(line.charAt(x)));
				}
			}
			this. grid = grid;
		}

		// 生态圈对象的最简单方法toString, 它将整个生态圈转化为一个字符串
		wall.character = '#';
		StupidBug.prototype.character = 'o';

		function characterFromElement (element) {
			if (element == undefined)
				return ' ';
			else
				return element.character;
		}

		// 现在可以使用Grid对象的each方法构建字符串了。
		Terrarium.prototype.toString = function () {
			var characters = [];
			var endOfLine = this.grid.width - 1;
			this.grid.each(function(point, value) {
				characters.push(characterFromElement(value));
				if (point.x == endOfLine)
					characters.push('\n');
			});
			return characters.join('');
		};
	</script>	
</body>
</html>